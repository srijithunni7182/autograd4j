<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/graph_visualization.md at 2026-02-13

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>autograd-java &#x2013; The MicroGPT Dynamic Computation Graph</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">autograd-java
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2026-02-13</span>
           | <span id="projectVersion">Version: 1.0-SNAPSHOT</span>
      </div>
      <div class="xright"><a href="${project.url}" title="autograd-java">autograd-java</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<h1>The MicroGPT Dynamic Computation Graph</h1>
<p>This document visualizes how <code>MicroGPT</code> builds its computation graph on the fly (&#x201c;Define-by-Run&#x201d;).</p><section>
<h2><a name="Legend"></a>Legend</h2>
<ul>

<li><b>Orange/Red Rectangles</b>: Permanent Weights (The &#x201c;Brain&#x201d;). These persist throughout the entire life of the program.</li>
<li><b>Pink/Yellow Ovals</b>: Temporary Values (The &#x201c;Thoughts&#x201d;). These are created for a single token and destroyed immediately after (or cached).</li>
</ul></section><section>
<h2><a name="a1._The_Components"></a>1. The Components</h2>

<div class="source">
<pre><code class="language-mermaid">graph TD
    subgraph Permanent_Memory [&quot;PERMANENT MEMORY (Weights)&quot;]
        direction TB
        WTE[&quot;Token Embeddings (wte)&quot;]
        WPE[&quot;Pos Embeddings (wpe)&quot;]
        WQ[&quot;Query Weights (attn_wq)&quot;]
        WK[&quot;Key Weights (attn_wk)&quot;]
        WV[&quot;Value Weights (attn_wv)&quot;]
    end

    subgraph Temporary_Graph [&quot;TEMPORARY GRAPH (Per Token)&quot;]
        direction TB
        x_in[&quot;Input x&quot;]
        q_vec[&quot;Query Vector&quot;]
        k_vec[&quot;Key Vector&quot;]
        v_vec[&quot;Value Vector&quot;]
        logits[&quot;Logits (Output)&quot;]
    end

    %% High Contrast Orange for Dark Mode
    style WTE fill:#ff9900,stroke:#333,stroke-width:2px,color:#000
    style WPE fill:#ff9900,stroke:#333,stroke-width:2px,color:#000
    style WQ fill:#ff9900,stroke:#333,stroke-width:2px,color:#000
    style WK fill:#ff9900,stroke:#333,stroke-width:2px,color:#000
    style WV fill:#ff9900,stroke:#333,stroke-width:2px,color:#000

    style x_in fill:#f9f,stroke:#333,color:#000
    style q_vec fill:#f9f,stroke:#333,color:#000
    style k_vec fill:#f9f,stroke:#333,color:#000
    style v_vec fill:#f9f,stroke:#333,color:#000
    style logits fill:#f9f,stroke:#333,color:#000
</code></pre></div></section><section>
<h2><a name="a2._Construction_.28Single_Token_Pass.29"></a>2. Construction (Single Token Pass)</h2>
<p>When <code>gpt()</code> runs for a token, it temporarily links the <b>Permanent Weights</b> to new <b>Temporary Values</b>.</p>

<div class="source">
<pre><code class="language-mermaid">graph TD
    %% Permanent Weights
    WTE[&quot;Weights: Token Emb&quot;]
    WQ[&quot;Weights: Query&quot;]

    %% Temporary Values
    t_emb[&quot;Temp: 'a' vector&quot;]
    q_vec[&quot;Temp: Query Vector&quot;]
    
    %% The Connections
    WTE --&gt;|Lookup| t_emb
    t_emb --&gt;|Input| q_vec
    WQ --&gt;|Multiply| q_vec
    
    %% Styling
    style WTE fill:#ff9900,stroke:#333,stroke-width:2px,color:#000
    style WQ fill:#ff9900,stroke:#333,stroke-width:2px,color:#000
    
    style t_emb fill:#f9f,stroke:#333,color:#000
    style q_vec fill:#f9f,stroke:#333,color:#000
</code></pre></div></section><section>
<h2><a name="a3._Training_vs_Inference_Lifecycle"></a>3. Training vs Inference Lifecycle</h2><section>
<h3><a name="Training_.28Forward_.2B_Backward.29"></a>Training (Forward + Backward)</h3>
<ol style="list-style-type: decimal">

<li><b>Build</b>: We build the full graph for a sequence (e.g., 32 tokens).</li>
<li><b>Hold</b>: We keep <i>everything</i> in memory.</li>
<li><b>Backward</b>: We traverse the graph from <code>Loss</code> back to <code>Weights</code>, calculating gradients.</li>
<li><b>Update</b>: We modify the <code>Weights</code> (Orange Nodes).</li>
<li><b>Destroy</b>: We delete all Temporary/Pink Nodes.</li>
</ol></section><section>
<h3><a name="Inference_.28Generation.29"></a>Inference (Generation)</h3>
<ol style="list-style-type: decimal">

<li><b>Build</b>: We build the graph for <i>one</i> token.</li>
<li><b>Predict</b>: We get the next token.</li>
<li><b>Cache</b>: We save <i>only</i> the Key/Value vectors (Yellow) to the KV Cache.</li>
<li><b>Destroy</b>: We delete everything else (q, logits, hidden states) immediately.</li>
</ol>

<div class="source">
<pre><code class="language-mermaid">graph TD
    subgraph KV_Cache [&quot;KV CACHE (Preserved)&quot;]
        K_history[&quot;Past Keys&quot;]
        V_history[&quot;Past Values&quot;]
    end
    
    subgraph Trash_Bin [&quot;GARBAGE COLLECTED&quot;]
        q_vec[&quot;Query Vector&quot;]
        x_vec[&quot;Hidden States&quot;]
        logits[&quot;Logits&quot;]
    end
    
    style K_history fill:#ff9,stroke:#333,color:#000
    style V_history fill:#ff9,stroke:#333,color:#000
    style q_vec fill:#f9f,stroke:#333,color:#000
    style x_vec fill:#f9f,stroke:#333,color:#000
    style logits fill:#f9f,stroke:#333,color:#000
</code></pre></div></section></section><section>
<h2><a name="a4._The_Training_Process_.28Step-by-Step.29"></a>4. The Training Process (Step-by-Step)</h2>
<p>This diagram illustrates how the optimizer interacts with the weights.</p>

<div class="source">
<pre><code class="language-mermaid">graph TD
    subgraph Weights [&quot;1. PERMANENT MEMORY&quot;]
        direction TB
        W_in[&quot;Weights&quot;]
    end

    subgraph Forward [&quot;2. FORWARD PASS&quot;]
        direction TB
        Input[(&quot;Input Data&quot;)] --&gt;|Combine| Graph[&quot;Dynamic Graph&quot;]
        W_in --&gt;|Used By| Graph
        Graph --&gt;|Produces| Output[&quot;Prediction&quot;]
    end

    subgraph Loss_Calc [&quot;3. LOSS CALCULATION&quot;]
        direction TB
        Output --&gt;|Compare| Loss[&quot;Loss Value&quot;]
        Target[(&quot;Target Data&quot;)] --&gt;|Compare| Loss
    end

    subgraph Backward [&quot;4. BACKWARD PASS&quot;]
        direction TB
        Loss --&gt;|Calculate Grads| Gradients[&quot;Gradients (.grad)&quot;]
    end

    subgraph Optimizer [&quot;5. OPTIMIZATION&quot;]
        direction TB
        Gradients --&gt;|Input| Adam[&quot;Adam Optimizer&quot;]
        Adam --&gt;|Update| W_in
    end

    %% High Contrast Orange for Weights
    style W_in fill:#ff9900,stroke:#333,stroke-width:2px,color:#000
    
    %% Pink for Dynamic Graph
    style Graph fill:#f9f,stroke:#333,color:#000
    style Output fill:#f9f,stroke:#333,color:#000
    style Loss fill:#f9f,stroke:#333,color:#000
    
    %% Blue for Optimizer
    style Adam fill:#add8e6,stroke:#333,color:#000
    style Gradients fill:#add8e6,stroke:#333,color:#000
</code></pre></div></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2026..      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
